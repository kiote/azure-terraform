apiVersion: v1
kind: Pod
metadata:
  name: postgres-test
  namespace: n8n
spec:
  containers:
  - name: postgres-test
    image: postgres:latest
    command: ['sh', '-c', 'pg_isready -h $(POSTGRES_HOST) -p $(POSTGRES_PORT) -U $(POSTGRES_USER)']
    env:
    - name: POSTGRES_HOST
      valueFrom:
        configMapKeyRef:
          name: n8n-config
          key: POSTGRES_HOST
    - name: POSTGRES_PORT
      valueFrom:
        configMapKeyRef:
          name: n8n-config
          key: POSTGRES_PORT
    - name: POSTGRES_USER
      valueFrom:
        configMapKeyRef:
          name: n8n-config
          key: POSTGRES_USER
    - name: POSTGRES_PASSWORD
      valueFrom:
        secretKeyRef:
          name: n8n-postgres-secret
          key: postgres-password
  restartPolicy: Never
